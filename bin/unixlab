#!/usr/bin/python2
import requests
import re

def remove_tags(html):
    return re.sub("<[^>]*>", "", html)

url = "http://apps.cs.utexas.edu/unixlabstatus/"

r = requests.get(url)

if not r:
    print "Error connecting to:", url
    exit(0)

html = r.content
r.close()

stations = []
lines = html.splitlines()

fields = ["host", "status", "uptime", "users", "load"]

i = 0
while i < len(lines):
    if "<td style" in lines[i]:
        host = {}

        for j in range(len(fields)):
            host[fields[j]] = remove_tags(lines[i+j])

        i += len(fields)
        stations.append(host)

    i += 1

# Remove the title row
stations.pop(0)

stations = filter(lambda s: s["status"] == "up", stations)
min_station = min(stations, key=lambda s: s["load"])

print min_station["host"] + ".cs.utexas.edu"

